# A Vertex-Based Solver for Steiner Multigraph Problem

An novel and efficient Branch-and-Cut based solver integrating with hybrid heuristics for Steiner Multigraph Problem (SMP) 👏💖. Our algorithms/solver are able to solve larger instances of more than ten thousands vertices in less than one hour.

The code also includes implementation of the Single-Commodity Flow (SCF), Multi-Commodity Flow (MCF) and Steiner Forest (SF) Model used only for comparison and analysis. 

## Difference between three Git branch:

-  `master`: a high level implementation, should only be used by code understanding.
- `ThomasLB`: implementing the separation by Lemon Graph Library.  Can be fully complied and run. 
- `ThomasLC`: implementing the separation without applying external tools but by self-dedicated snippets codes.  Can be fully complied and run. 

## Preparations

The original code is guaranteed to be complied and executed only on Windows 10 yet (not tested on other OS). 

Follow the necessary steps below to make it run 😊:

1. Install [Visual Studio 2017](https://visualstudio.microsoft.com/zh-hans/vs/older-downloads/);
2. Download [CPLEX 12.7.1](https://www.ibm.com/support/pages/downloading-ibm-ilog-cplex-optimization-studio-v1271); 
3. Download [Lemon Graph Library](https://lemon.cs.elte.hu/trac/lemon);
4. Follow the [User Manual](https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=&ved=2ahUKEwijzrXBl5j0AhWMM-wKHRPxB7wQFnoECAoQAQ&url=https%3A%2F%2Fwww.ibm.com%2Fdocs%2FSSSA5P_12.7.1%2Filog.odms.studio.help%2Fpdf%2Fusrcplex.pdf&usg=AOvVaw031LURd83gHUqCWHXEs3lb) for CPLEX and [Install Instruction](https://lemon.cs.elte.hu/trac/lemon/wiki/InstallCmake) for Lemon to install both assistant tools and make it compact to Visual Studio 2017. 

## Compile and Run

1. To compile, select Build->Build Solution (or press F7) on main bar of Visual Studio 2017's coding window.

2. To run .exe file, the command line can be changed arbitrarily but should contain following indexes:

   ```
   $ exeAbsltLocation, tempDataLocation, formulation, callback_option, relax_option, ns_sep_opt, 
   LB_MaxRestart, LB_MaxIter, Rmin, Rmax, BCSolNum, BCTime, MIPDisplayLevel, TimeLimit, MaxCutNumberLazy, 
   epsilonLazy, MaxCutNumberUser, epsilonUser, UseLocalBranch, LP_CP_Option, LazySepOpt
   ```

   Explanation of the parameters:

   | Parameter Name   | Usage                                                        |
   | :--------------- | :----------------------------------------------------------- |
   | exeAbsltLocation | Absolute path of executable .exe file                        |
   | tempDataLocation | Data location                                                |
   | formulation      | Which formulation would like run, 1: SCF, 2:MCF, 3:SF, 4:NS  |
   | callback_option  | Add callkack for SF and NS: 1 use only LZ , 2: use only User 3: both LZ and User |
   | relax_option     | Solving MIP with relaxation, 1: Yes, 0: No                   |
   | ns_sep_opt       | When row generation for User Cut finished, 1: check the feasibility of Cut using LZ separation, 0: not do so |
   | LB_MaxRestart    | Valid only when Local Search applied, control the maximum number of search restart |
   | LB_MaxIter       | Valid only when Local Search applied, control the maximum number of iteration using same initial solution |
   | Rmin             | Valid only when Local Search applied, minimum of search radius in feasible region |
   | Rmax             | Valid only when Local Search applied, maximum of search radius in feasible region |
   | BCSolNum         | Valid only when Local Search applied, maximum solution number can be found in B&C in one iteration |
   | BCTime           | Valid only when Local Search applied, maximum solving time in B&C in one iteration |
   | MIPDisplayLevel  | Control the display level for CPLEX                          |
   | TimeLimit        | Time limit for running the solver                            |
   | MaxCutNumberLazy | Maximum number of cut added in Lazy separation finished      |
   | epsilonLazy      | The error threshold for the cut generated by Lazy separation |
   | MaxCutNumberUser | Maximum number of cut added in User separation finished      |
   | epsilonUser      | The error threshold for the cut generated by User separation |
   | UseLocalBranch   | 1: Use Local Branch globally, 0: not                         |
   | LP_CP_Option     | 1: Use Cut pool, add violation constraint as cut in LB stage, 0: do not use cut pool add violation as constraint |
   | LazySepOpt       | In LZ separation, 1: generate cut between all pairs of SCC, 0: generate cut between only first SCC and others |

## Contents in each file

Following table summarizes the major contents in each file:

| File Name        | Contents                                                     |
| ---------------- | ------------------------------------------------------------ |
| `main.cpp`       | The entry of the code. Parser the input command and initialize the raw model. |
| `readers.cpp`    | Used for loading the data, meanwhile check whether the graph is legal (optional). |
| `type.h`         | Defines all customized type and variables alias.             |
| `graph.h`        | Defines the graph structure used in solver.                  |
| `unionfind.h`    | Implementation of Union-Find algorithm.                      |
| `smp.h`          | Head file for `smp.cpp`, defines the general solver class and the one integrating Local Branch . |
| `smp.cpp`        | Implementation of 4 different algorithms and set all necessary parameters for CPLEX. |
| `seperation.h`   | Head file for `seperaion.cpp`. Defines function format and necessary parameters. |
| `seperation.cpp` | Implementation of SCC and Min-cut separation for SF and NS model. |
| `callback.h`     | Defines the interactive callback option for SF and NS in CPLEX. |


